@extends('adminlte::page')
@section('content')
@section('title', 'mapa-epidemiologico')
<div class="row justify-content-center">
    <div class="col">
        <h1>Mapa Epidemiológico (G3)</h1>
        <div id="map" style="height: 900px; width:100%;"></div>
    </div>

@endsection
@section('js')
    <script>
        // Inicializar el mapa centrado en una ubicación específica
        const map = L.map('map').setView([-35.02867080, -71.74547960], 12);

        // Añadir capa base de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 17,
            attribution: 'Hospital de Hualañe'
        }).addTo(map);

        // Definir los polígonos con un arreglo de coordenadas (lat, lon)
        const sectorCeleste = [
            
        ];

        const sectorNaranjo = [
            [-34.97947295842924, -71.81484715482142],
            [-34.97847178012749, -71.81363906710187],
            [-34.97774059810927, -71.80871678180988],
            [-34.97598235028906, -71.8051284619257],
            [-34.97531057986951, -71.80445491854908],
            [-34.97514207920897, -71.8045063282575],
            [-34.97436445219148, -71.80379660775384],
            [-34.973229579453225, -71.80272888577434],
            [-34.97118363380915, -71.80081965626056],
            [-34.97050808968519, -71.8001867876322],
            [-34.96975553857118, -71.79798519676463],
            [-34.96599575006212, -71.79314443597792],
            [-34.961972460834986, -71.79051106082447],
            [-34.96186802085787, -71.79045200028666],
            [-34.96172279638072, -71.7904572801615],
            [-34.961597078851035, -71.79049144578903],
            [-34.96133532472441, -71.79059980109224],
            [-34.96120640631808, -71.79062452551167],
            [-34.961080819226424, -71.79062430486853],
            [-34.96097173675915, -71.79060356854849],
            [-34.960874034519506, -71.79054480100584],
            [-34.96078022587257, -71.79045516196345],
            [-34.96067389708333, -71.79029420952739],
            [-34.960543492897685, -71.79016933888572],
            [-34.96043766406558, -71.7900822280697],
            [-34.9602835566605, -71.7899971825987],
            [-34.96004475550736, -71.78991140599642],
            [-34.95992944405999, -71.78983301356567],
            [-34.95981603484729, -71.78971356976967],
            [-34.95899457360886, -71.78872446186007],
            [-34.95871113719167, -71.78837394299848],
            [-34.95851819071032, -71.78804612043793],
            [-34.95847071677229, -71.78799737331609],
            [-34.95839327912494, -71.7879473552324],
            [-34.95792770200955, -71.78779307346016],
            [-34.957767708934085, -71.78772793321008],
            [-34.95755689862727, -71.78762507325779],
            [-34.95738381475372, -71.7875112655797],
            [-34.95713474026994, -71.78729666270733],
            [-34.95687912337664, -71.78703239129257],
            [-34.95626942140704, -71.786444440872],
            [-34.95543683559784, -71.78552247064457],
            [-34.95451070716834, -71.78480263822391],
            [-34.95364086109333, -71.78453661472686],
            [-34.952773853652936, -71.7843567803071],
            [-34.95252052794262, -71.78423222150877],
            [-34.95208418241717, -71.78386544353324],
            [-34.951863924856774, -71.78384853055468],
            [-34.951633337784884, -71.78406966942198],
            [-34.95142762098149, -71.78414909366117],
            [-34.951234996020816, -71.78418905446749],
            [-34.948730892862386, -71.78826923909739],
            [-34.945093880614614, -71.80000726361354],
            [-34.94441748210252, -71.81407079559499],
            [-34.946193630809724, -71.82279819056369],
            [-34.9486287307549, -71.83054784521802],
            [-34.9501796595531, -71.83667818038542],
            [-34.95197555669852, -71.83964388951581],
            [-34.95320814532542, -71.83836711453718],
            [-34.954435995744994, -71.83708280349062],
            [-34.95694906328427, -71.8369133562453],
            [-34.95965506053309, -71.83570354958975],
            [-34.96427928240419, -71.8326247545015],
            [-34.96791510784594, -71.83211548343256],
            [-34.969768244355365, -71.83107763712023],
            [-34.97216507925214, -71.83313033005447],
            [-34.97384724114044, -71.83798619227548],
            [-34.97752502355679, -71.84170554368643],
            [-34.977441023036604, -71.84075465354715],
            [-34.97737771338975, -71.8388708301028],
            [-34.97752406979074, -71.83667280594645],
            [-34.97736735117824, -71.83531042023394],
            [-34.97674489405792, -71.83324111496398],
            [-34.97386338390577, -71.8270095427634],
            [-34.973570043625365, -71.8262266388031],
            [-34.97310883276459, -71.82515194965018],
            [-34.97276363940125, -71.82455250461858],
            [-34.97208275189077, -71.8234632925637],
            [-34.97177694272089, -71.82285130498798],
            [-34.97147867554714, -71.82200908335273],
            [-34.97129272527374, -71.82131732639779],
            [-34.97110979175548, -71.82010514097037],
            [-34.97095116224841, -71.81877557613794],
            [-34.9709207737864, -71.81862758650361],
            [-34.97089705642302, -71.81825692720264],
            [-34.97093346238866, -71.81783097891827],
            [-34.97100282129329, -71.81750329493791],
            [-34.97111743593844, -71.81722196128202],
            [-34.97136654366847, -71.81687108175555],
            [-34.97236578897923, -71.81632342712919],
            [-34.97276800537711, -71.8161531624979],
            [-34.97319443943906, -71.81590987466065],
            [-34.97360921850262, -71.81561800695448],
            [-34.97401888736505, -71.81541043298655],
            [-34.9744812666536, -71.81521190000575],
            [-34.97506195107176, -71.81503728630811],
            [-34.97598136728029, -71.81493337723276],
            [-34.977020001625846, -71.81491095942263],
            [-34.97800465253767, -71.81492288531449],
            [-34.97876629371207, -71.81494835456314],
            [-34.979462557611, -71.81485849721382]
        ];

        // Crear el polígono para cada área con propiedades específicas (color, borde, etc.)
        const celeste = L.polygon(sectorCeleste, {
            color: "sky-blue",
            fillColor: "#98F5F9",
            fillOpacity: 0.4,
            tile: 'Celeste',
            smoothFactor: 1

        }).addTo(map);

        const naranjo = L.polygon(sectorNaranjo, {
            color: "orange",
            fillColor: "#ff730070",
            fillOpacity: 0.5,
        }).addTo(map);

        // Array de pacientes desde el backend (Blade)
        var g3 = @json($g3);


        // Añadir marcadores al mapa
        g3.forEach(function(g3) {
            L.marker([g3.latitud, g3.longitud], {
                    iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-icon-2x.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                    shadowSize: [41, 41],
                    radius: 7,
                    fillOpacity: 0.3,
                }).addTo(map)
                .bindPopup(
                    `<b>Rut.: </b>${g3.rut}<br>
                <b>Nombres: </b>${g3.nombres}<br>
                <b>Apellidos: </b>${g3.apellidoP} ${g3.apellidoM}<br>
                <b class="text-danger text-bold">G3</b><br>
                <b>Direccion: </b>${g3.direccion} ${g3.comuna}<br>
                <b>LAT: </b>${g3.latitud}<br>
                <b>LNG: </b>${g3.longitud}<br>
                <b>Sector: </b>${g3.sector}<br>
                `);
        });
    </script>

@endsection
